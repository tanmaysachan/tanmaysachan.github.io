<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../styles.css">
    <meta name="google-site-verification" content="LM4GhB5Y1CsiX4EhmQygTx1arB_gKDc0wQjpK2MFTOs" />
    <meta name="description" content="A write-up by Tanmay Sachan on machine learning, systems programming, and computer science." />
    <meta name="author" content="Tanmay Sachan" />
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="Tanmay Sachan's Blog" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    
    <!-- Rubik font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">

    <!-- The loading of KaTeX is deferred to speed up page rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">

    <!-- The loading of KaTeX is deferred to speed up page rendering -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>

    <!-- To automatically render math in text elements, include the auto-render extension: -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

    <script src="../loader.js"></script>

    <script src="https://kit.fontawesome.com/9016fec2c3.js" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>

    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?autorun=false"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="../assets/favicon_io/site.webmanifest" crossorigin="use-credentials">

    <title>A small collection</title>
  </head>
  <body>
    <!-- Theme Toggle -->
    <div class="theme-toggle">
      <button class="theme-toggle-btn" id="theme-toggle" title="Toggle theme">
        <!-- Sun Icon -->
        <svg class="theme-icon icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <!-- Moon Icon -->
        <svg class="theme-icon icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
        <!-- System Icon -->
        <svg class="theme-icon icon-system" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
          <line x1="8" y1="21" x2="16" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="12" y1="17" x2="12" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <div class="container col-sm" id="site-header">
    </div>
    <div class="container row" id="shareable-box">
      <div class="col">
        <!-- <a id="shareable-link" href="javascript:void(0);"><i class="fa-solid fa-link"></i> Copy shareable link for this write-up</a> -->
      </div>
    </div>
    <div class="row" id="content-block">
      <div class="col-xs" id="back-button">
        <a href="../index.html"><i class="fa-solid fa-chevron-left"></i></a>
      </div>
      <div class="container float-left col" id="post-block" style="font-family: 'Rubik', sans-serif;">
          <h1 id="splitcomputeandworkingwithtensors">SplitCompute and working with Tensors</h1>
<p>SplitCompute - <a href="https://github.com/tanmaysachan/splitcompute" target="_blank">github link</a></p>
<p>For the last week or so, I had been working on this project I called "SplitCompute", with the intention of
sharding neural networks between the cloud and the edge. This could potentially allow low to no cloud GPU costs
for inference on such models.</p>
<p>The idea behind sharding, instead of just transferring, was that no one wants 5-10GB of models being
downloaded to their browsers and then run there. ML on the edge is definitely getting better,
but it is still not very feasible because of the transfer and compute requirements.</p>
<p>For the most part, the project turned out to be successful - for arbitrary embedding-based models, you can use
the components and get it to work.
The problem with the project was that the problem I set out to solve - wasn't really one :(</p>
<h3 id="thecore">The Core</h3>
<h5 id="whywebgputorch">Why webgpu-torch</h5>
<p>While looking for ways to run neural networks in the browser, I stumbled upon some of Karpathy's <a href="https://cs.stanford.edu/people/karpathy/convnetjs/" target="_blank">work</a>
because of course he had tried to do this 11 years ago. It was pure JS, which was still quite performant. I was looking for something lower-level still.</p>
<p>ONNX runtime is another popular choice to run models, but I was unsure how to shard the NNs with it. Moreover, its performance was dubious from
what I had read online.</p>
<p>Eventually I stumbled upon an unfinished library with a torch-like API written in TS - <a href="https://github.com/praeclarum/webgpu-torch" target="_blank">webgpu-torch</a>.
It was full of bugs and incomplete code, but it felt like a good exercise to fix and extend it, so I went along with it.</p>
<p>When it did work, it was really fast - fast enough not to impact UX.</p>
<h5 id="howitworks">How it works</h5>
<p>Webgpu-torch uses lazy buffers to handle tensors - each being associated with a computation graph. The computation graph is compiled into kernels, which are really
just WGSL strings containing bindings and ops.</p>
<p>The library does no kernel fusion at the moment, though I'm planning to add that when I get the time. <a href="https://github.com/tinygrad/tinygrad" target="_blank">Tinygrad</a> has already
done most of this.</p>
<h3 id="theproblemwiththeproblem">The problem with the problem</h3>
<p>It was always a benefit-convenience tradeoff, but the benefit is far smaller than I expected. GPU costs for embedding models aren't really that big a concern
for most commercial users, and the added complexity far outweighs the pros.</p>
<p>Overall, it was a fun week or two. It was also nice to dive into various tensor library internals and find a LOT of absolute slop (tensorflow).</p>
      </div>
      <div id="not-mobile" class="col">
      </div>
    </div>

    <!-- Bootstrap JS (optional) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Theme Toggle Script -->
    <script>
      (function() {
        const THEME_KEY = 'theme-preference';
        const THEMES = ['light', 'dark', 'system'];
        const TITLES = { light: 'Light mode', dark: 'Dark mode', system: 'System preference' };
        
        function getSystemTheme() {
          return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        
        function applyTheme(theme) {
          const effectiveTheme = theme === 'system' ? getSystemTheme() : theme;
          document.documentElement.setAttribute('data-theme', effectiveTheme);
          
          // Update icon visibility
          document.querySelectorAll('.theme-icon').forEach(icon => icon.classList.remove('active'));
          const activeIcon = document.querySelector('.icon-' + (theme === 'light' ? 'sun' : theme === 'dark' ? 'moon' : 'system'));
          if (activeIcon) activeIcon.classList.add('active');
          
          // Update button title
          const btn = document.getElementById('theme-toggle');
          if (btn) btn.title = TITLES[theme];
        }
        
        function cycleTheme() {
          const current = localStorage.getItem(THEME_KEY) || 'system';
          const nextIndex = (THEMES.indexOf(current) + 1) % THEMES.length;
          const next = THEMES[nextIndex];
          localStorage.setItem(THEME_KEY, next);
          applyTheme(next);
        }
        
        // Initialize theme on page load
        const savedTheme = localStorage.getItem(THEME_KEY) || 'system';
        applyTheme(savedTheme);
        
        // Set up button click handler
        document.getElementById('theme-toggle').addEventListener('click', cycleTheme);
        
        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
          if (localStorage.getItem(THEME_KEY) === 'system') {
            applyTheme('system');
          }
        });
      })();
    </script>
  </body>
</html>
